<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The English Hub</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Fraunces:ital,wght@1,700&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/twemoji.min.js" crossorigin="anonymous"></script>

<style>
  :root{
    /* Explore tokens */
    --bg:#111118;
    --bg2:#18181f;
    --bg3:#1f1f28;
    --line:rgba(255,255,255,0.08);
    --text:#f0f0f5;
    --muted:#8888aa;

    /* Category colors (index-specific mapping, aligned with Explore vibe) */
    --cap:#ff5252;   /* proche de Play */
    --mbbe:#ffc947;  /* proche de World */
    --mrc:#00d68f;   /* proche de Listen */
    --agora:#c77dff; /* proche de Smart */
    --bts:#5b8fff;   /* proche de Watch */
  }

  *{margin:0;padding:0;box-sizing:border-box}

  html { scroll-behavior:smooth; }

  body{
    font-family:'Outfit',sans-serif;
    background:var(--bg);
    color:var(--text);
    min-height:100vh;
  }

  /* Explore grain overlay */
  body::after{
    content:'';
    position:fixed; inset:0; z-index:999; pointer-events:none;
    background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size:180px;
    opacity:0.028;
  }

  a:focus-visible, button:focus-visible{
    outline:2px solid rgba(255,255,255,0.35);
    outline-offset:3px;
    border-radius:10px;
  }

  /* ‚îÄ‚îÄ HEADER (same structure as Explore) ‚îÄ‚îÄ */
  header{
    padding:0 40px;
    border-bottom:1px solid var(--line);
  }
  .header-top{
    display:flex; align-items:center; justify-content:space-between;
    padding:16px 0;
    border-bottom:1px solid var(--line);
  }
  .brand{
    display:inline-flex; align-items:center; gap:10px;
    text-decoration:none;
    color:var(--text);
  }
  .brand-mark{
    width:30px; height:30px; border-radius:8px;
    border:1px solid var(--line);
    background:linear-gradient(135deg, rgba(255,82,82,0.18), rgba(91,143,255,0.18), rgba(0,214,143,0.18));
    display:flex; align-items:center; justify-content:center;
    font-size:14px;
  }
  .brand-name{
    font-size:12px; font-weight:700; letter-spacing:1.5px;
    text-transform:uppercase;
    color:var(--muted);
  }
  .header-tag{
    font-size:11px; letter-spacing:2px; text-transform:uppercase;
    color:var(--muted);
  }

  .header-hero{
    padding:44px 0 36px;
    display:flex; align-items:flex-end; justify-content:space-between; gap:32px;
    flex-wrap:wrap;
  }

  .page-title{
    font-size: clamp(3.6rem, 10vw, 8rem);
    font-weight:900;
    letter-spacing:-3px;
    line-height:0.9;
  }
  .page-title .accent{
    font-family:'Fraunces', serif;
    font-style:italic;
    font-weight:700;
    color:var(--cap);
    letter-spacing:-2px;
  }

  .header-sub{
    font-size:14px;
    color:var(--muted);
    line-height:1.7;
    max-width:320px;
    text-align:right;
    padding-bottom:6px;
  }

  /* ‚îÄ‚îÄ QUICK LINKS (like Explore nav tone) ‚îÄ‚îÄ */
  .quick-links{
    padding:0 40px;
    border-bottom:1px solid var(--line);
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:12px 14px;
    font-size:11px; font-weight:800; letter-spacing:1.5px;
    text-transform:uppercase;
    color:var(--muted);
    text-decoration:none;
    border:1px solid var(--line);
    border-radius:999px;
    background:rgba(255,255,255,0.02);
    transition:background 0.2s, border-color 0.2s, color 0.2s, transform 0.2s;
  }
  .pill:hover{
    background:rgba(255,255,255,0.05);
    border-color:rgba(255,255,255,0.14);
    color:var(--text);
    transform:translateY(-1px);
  }
  .pill.explore:hover{ border-color:rgba(255,82,82,0.35); color:var(--cap); }
  .pill.resources:hover{ border-color:rgba(199,125,255,0.35); color:var(--agora); }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  main{ max-width:1100px; margin:0 auto; padding:0 40px 80px; }

  .section{
    padding-top:54px;
  }
  .section-head{
    display:flex; align-items:center; gap:16px;
    margin-bottom:18px;
  }
  .section-label{
    font-size:10px; letter-spacing:3px; text-transform:uppercase;
    color:var(--muted); flex-shrink:0;
  }
  .section-title{
    font-size:1.6rem; font-weight:900;
    letter-spacing:-0.5px;
  }
  .section-line{ flex:1; height:1px; background:var(--line); }
  .section-desc{ font-size:12px; color:var(--muted); font-style:italic; }

  /* ‚îÄ‚îÄ GRID (like Explore cards-grid) ‚îÄ‚îÄ */
  .cards-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));
    gap:10px;
  }

  /* ‚îÄ‚îÄ CARD (adapted from Explore) ‚îÄ‚îÄ */
  .card{
    background:var(--bg2);
    border-radius:10px;
    border:1px solid var(--line);
    padding:22px 20px 18px;
    text-decoration:none;
    color:inherit;
    display:flex; flex-direction:column; gap:10px;
    position:relative;
    overflow:hidden;
    transition:border-color 0.2s, background 0.2s, transform 0.2s;
    cursor:pointer;
    opacity:0;
    transform:translateY(18px);
  }
  .card.visible{ opacity:1; transform:translateY(0); }
  .card:hover{ background:var(--bg3); transform:translateY(-2px); }

  .card::before{
    content:'';
    position:absolute;
    left:0; top:16px; bottom:16px;
    width:2px; border-radius:2px;
    opacity:0; transition:opacity 0.2s;
  }
  .card:hover::before{ opacity:1; }

  .card-top{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  .card-emoji{
    font-size:1.9rem;
    filter: drop-shadow(0 4px 12px rgba(0,0,0,0.25));
  }
  .card-level{
    font-size:10px; font-weight:800; letter-spacing:2px;
    text-transform:uppercase;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.04);
    color:var(--muted);
  }

  .card-name{ font-size:1.1rem; font-weight:800; letter-spacing:-0.2px; }
  .card-desc{ font-size:12.5px; color:var(--muted); line-height:1.6; flex:1; }

  .units{
    display:flex; flex-direction:column; gap:8px;
    margin-top:2px;
  }
  .unit{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.05);
    background:rgba(255,255,255,0.02);
    font-size:12.5px;
    color:var(--text);
  }
  .unit-dot{
    width:8px; height:8px; border-radius:50%;
    flex-shrink:0;
    opacity:0.95;
  }
  .unit-num{
    margin-left:auto;
    font-size:11px;
    letter-spacing:1px;
    color:var(--muted);
    font-weight:800;
  }

  .card-cta{
    display:inline-flex; align-items:center; gap:6px;
    font-size:11px; font-weight:900; letter-spacing:1.5px;
    text-transform:uppercase; margin-top:6px;
    transition:gap 0.2s;
  }
  .card:hover .card-cta{ gap:10px; }

  /* Category coloring */
  .cap{ }
  .mbbe{ }
  .mrc{ }
  .agora{ }
  .bts{ }

  .cap::before{ background:var(--cap); }
  .mbbe::before{ background:var(--mbbe); }
  .mrc::before{ background:var(--mrc); }
  .agora::before{ background:var(--agora); }
  .bts::before{ background:var(--bts); }

  .cap:hover{ border-color:rgba(255,82,82,0.25); }
  .mbbe:hover{ border-color:rgba(255,201,71,0.25); }
  .mrc:hover{ border-color:rgba(0,214,143,0.25); }
  .agora:hover{ border-color:rgba(199,125,255,0.25); }
  .bts:hover{ border-color:rgba(91,143,255,0.25); }

  .cap .unit-dot{ background:var(--cap); }
  .mbbe .unit-dot{ background:var(--mbbe); }
  .mrc .unit-dot{ background:var(--mrc); }
  .agora .unit-dot{ background:var(--agora); }
  .bts .unit-dot{ background:var(--bts); }

  .cap .card-name{ color:var(--cap); }
  .mbbe .card-name{ color:var(--mbbe); }
  .mrc .card-name{ color:var(--mrc); }
  .agora .card-name{ color:var(--agora); }
  .bts .card-name{ color:var(--bts); }

  .cap .card-cta{ color:var(--cap); }
  .mbbe .card-cta{ color:var(--mbbe); }
  .mrc .card-cta{ color:var(--mrc); }
  .agora .card-cta{ color:var(--agora); }
  .bts .card-cta{ color:var(--bts); }

  /* ‚îÄ‚îÄ FOOTER (Explore-like) ‚îÄ‚îÄ */
  footer{
    border-top:1px solid var(--line);
    padding:24px 40px;
    display:flex; justify-content:space-between; align-items:center;
    flex-wrap:wrap; gap:12px;
  }
  .footer-brand{ font-size:14px; font-weight:800; color:var(--text); }
  .footer-meta{ font-size:11px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); }

  /* ‚îÄ‚îÄ MODAL (restyled to match Explore) ‚îÄ‚îÄ */
  .modal-overlay{
    display:none;
    position:fixed; inset:0;
    background:rgba(0,0,0,0.72);
    backdrop-filter: blur(10px);
    z-index:1000;
    align-items:center; justify-content:center;
    padding:20px;
  }
  .modal-overlay.open{ display:flex; }

  .modal{
    width:100%;
    max-width:900px;
    max-height:86vh;
    overflow:auto;
    border-radius:14px;
    border:1px solid var(--line);
    background:var(--bg2);
  }

  .modal-header{
    position:sticky; top:0;
    padding:18px 18px 14px;
    border-bottom:1px solid var(--line);
    background:rgba(24,24,31,0.92);
    backdrop-filter: blur(12px);
    display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
  }
  .modal-title{
    font-size:1.2rem;
    font-weight:900;
    letter-spacing:-0.2px;
  }
  .modal-sub{
    margin-top:4px;
    font-size:12px;
    color:var(--muted);
    line-height:1.5;
  }
  .modal-close{
    width:38px; height:38px;
    border-radius:10px;
    border:1px solid var(--line);
    background:rgba(255,255,255,0.04);
    color:var(--text);
    font-size:18px;
    cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    transition:background 0.2s, border-color 0.2s;
    flex-shrink:0;
  }
  .modal-close:hover{
    background:rgba(255,255,255,0.08);
    border-color:rgba(255,255,255,0.14);
  }
  .modal-body{ padding:18px; }

  /* Modal content: keep your magazine layout but match visuals */
  .mag-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:10px;
  }
  .mag-card{
    background:var(--bg3);
    border:1px solid rgba(255,255,255,0.07);
    border-radius:12px;
    overflow:hidden;
    cursor:pointer;
    transition:transform 0.2s, border-color 0.2s;
  }
  .mag-card:hover{
    transform:translateY(-2px);
    border-color:rgba(255,255,255,0.14);
  }
  .mag-img{
    width:100%;
    height:150px;
    object-fit:cover;
    display:block;
    background:rgba(255,255,255,0.04);
  }
  .mag-img-placeholder{
    width:100%;
    height:150px;
    display:flex; align-items:center; justify-content:center;
    font-size:2.4rem;
    background:rgba(255,255,255,0.04);
  }
  .mag-body{ padding:14px; display:flex; flex-direction:column; gap:8px; }
  .mag-badge{
    display:inline-flex;
    align-items:center;
    font-size:10px;
    font-weight:900;
    letter-spacing:2px;
    text-transform:uppercase;
    padding:5px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.03);
    color:var(--muted);
    width:max-content;
  }
  .mag-title{
    font-size:14px;
    font-weight:900;
    letter-spacing:-0.2px;
    color:var(--text);
    line-height:1.2;
  }
  .mag-desc{
    font-size:12px;
    color:var(--muted);
    line-height:1.55;
    min-height:38px;
  }
  .mag-footer{
    display:flex; align-items:center; justify-content:space-between;
    padding-top:10px;
    border-top:1px solid rgba(255,255,255,0.07);
    margin-top:6px;
    font-size:11px;
    letter-spacing:1.5px;
    text-transform:uppercase;
    color:var(--muted);
    font-weight:800;
  }

  /* Detail view inside modal */
  .mag-detail{ display:none; }
  .mag-detail.open{ display:block; }

  .detail-head{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    margin-bottom:12px;
  }
  .back-btn{
    display:inline-flex; align-items:center; gap:8px;
    font-size:11px; font-weight:900; letter-spacing:1.5px;
    text-transform:uppercase;
    color:var(--muted);
    border:1px solid var(--line);
    background:rgba(255,255,255,0.03);
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    transition:background 0.2s, border-color 0.2s, color 0.2s;
  }
  .back-btn:hover{
    background:rgba(255,255,255,0.06);
    border-color:rgba(255,255,255,0.14);
    color:var(--text);
  }
  .detail-title{
    font-size:13px;
    letter-spacing:2px;
    text-transform:uppercase;
    color:var(--muted);
    font-weight:900;
    text-align:right;
  }

  .detail-img{
    width:100%;
    height:200px;
    object-fit:cover;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.03);
    margin-bottom:12px;
    display:block;
  }
  .detail-desc{
    font-size:13px;
    color:var(--muted);
    line-height:1.7;
    padding:12px 14px;
    border:1px solid rgba(255,255,255,0.07);
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    margin-bottom:14px;
  }

  .detail-section-title{
    font-size:10px;
    letter-spacing:3px;
    text-transform:uppercase;
    color:var(--muted);
    font-weight:900;
    margin:14px 0 10px;
  }

  .ws-row{
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    padding:10px 12px;
    border:1px solid rgba(255,255,255,0.07);
    background:rgba(255,255,255,0.02);
    border-radius:12px;
    margin-bottom:10px;
  }
  .ws-name{ font-size:13px; font-weight:800; color:var(--text); flex:1; min-width:160px; }
  .ws-btn{
    display:inline-flex; align-items:center; gap:6px;
    padding:8px 12px;
    border-radius:12px;
    font-size:11px; font-weight:900; letter-spacing:1.2px;
    text-transform:uppercase;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(255,255,255,0.04);
    color:var(--text);
    text-decoration:none;
    transition:transform 0.15s, background 0.2s, border-color 0.2s;
  }
  .ws-btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.16); }

  /* Mobile */
  @media (max-width:600px){
    header, .quick-links, main, footer{ padding-left:20px; padding-right:20px; }
    .header-hero{ flex-direction:column; align-items:flex-start; gap:16px; }
    .header-sub{ text-align:left; }
    .cards-grid{ grid-template-columns:1fr; }
  }
</style>
</head>

<body>

<header>
  <div class="header-top">
    <a class="brand" href="index.html">
      <span class="brand-mark">EH</span>
      <span class="brand-name">The English Hub</span>
    </a>
    <span class="header-tag">Lyc√©e des m√©tiers Florian</span>
  </div>

  <div class="header-hero">
    <h1 class="page-title">The <span class="accent">English</span> Hub</h1>
    <p class="header-sub">Choisis ta classe. Retrouve tes unit√©s, tes documents et tes supports.</p>
  </div>
</header>

<div class="quick-links">
  <a class="pill resources" href="resources.html">üìö Ressources</a>
  <a class="pill explore" href="explore.html">üåç Explore</a>
</div>

<main>
  <section class="section" id="classes">
    <div class="section-head">
      <span class="section-label">01</span>
      <span class="section-title">Mes classes</span>
      <div class="section-line"></div>
      <span class="section-desc">Choisis ton parcours.</span>
    </div>

    <div class="cards-grid">

      <div class="card cap" role="button" tabindex="0" onclick="openModal('cap')" onkeydown="if(event.key==='Enter'||event.key===' '){openModal('cap')}">
        <div class="card-top">
          <span class="card-emoji">üõçÔ∏è</span>
          <span class="card-level">CAP</span>
        </div>
        <div class="card-name">CAP TEPC</div>
        <div class="card-desc">√âquipier Polyvalent du Commerce. Units et documents de l‚Äôann√©e.</div>
        <div class="units">
          <div class="unit"><span class="unit-dot"></span> Unit 1 ‚Äî Healthy ME! <span class="unit-num">U1</span></div>
          <div class="unit"><span class="unit-dot"></span> Unit 2 ‚Äî What I did <span class="unit-num">U2</span></div>
          <div class="unit"><span class="unit-dot"></span> Unit 3 ‚Äî Let's GO Shopping <span class="unit-num">U3</span></div>
        </div>
        <span class="card-cta">Ouvrir ‚Üí</span>
      </div>

      <div class="card mbbe" role="button" tabindex="0" onclick="openModal('mbbe')" onkeydown="if(event.key==='Enter'||event.key===' '){openModal('mbbe')}">
        <div class="card-top">
          <span class="card-emoji">üß¥</span>
          <span class="card-level">2nde</span>
        </div>
        <div class="card-name">2nde MBBE</div>
        <div class="card-desc">M√©tiers de la Beaut√© et du Bien-√™tre. Units + t√¢ches finales.</div>
        <div class="units">
          <div class="unit"><span class="unit-dot"></span> UNIT 1 ‚Äî GAME ON! <span class="unit-num">U1</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 2 ‚Äî Your SKILLS Your JOB <span class="unit-num">U2</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 3 ‚Äî MY FIRST DAY <span class="unit-num">U3</span></div>
        </div>
        <span class="card-cta">Ouvrir ‚Üí</span>
      </div>

      <div class="card mrc" role="button" tabindex="0" onclick="openModal('mrc')" onkeydown="if(event.key==='Enter'||event.key===' '){openModal('mrc')}">
        <div class="card-top">
          <span class="card-emoji">üõí</span>
          <span class="card-level">2nde</span>
        </div>
        <div class="card-name">2nde MRC</div>
        <div class="card-desc">M√©tiers de la Relation Client. Documents et s√©quences.</div>
        <div class="units">
          <div class="unit"><span class="unit-dot"></span> UNIT 1 ‚Äî GAME ON! <span class="unit-num">U1</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 2 ‚Äî Your SKILLS Your JOB <span class="unit-num">U2</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 3 ‚Äî WHAT I DID! <span class="unit-num">U3</span></div>
        </div>
        <span class="card-cta">Ouvrir ‚Üí</span>
      </div>

      <div class="card agora" role="button" tabindex="0" onclick="openModal('agora')" onkeydown="if(event.key==='Enter'||event.key===' '){openModal('agora')}">
        <div class="card-top">
          <span class="card-emoji">üéôÔ∏è</span>
          <span class="card-level">Tle</span>
        </div>
        <div class="card-name">Tle AGORA</div>
        <div class="card-desc">Bac Pro AGORA. Units, projets et supports.</div>
        <div class="units">
          <div class="unit"><span class="unit-dot"></span> UNIT 1 ‚Äî Schools Around the World <span class="unit-num">U1</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 2 ‚Äî From Bombay to L.A. <span class="unit-num">U2</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 3 ‚Äî My Internship <span class="unit-num">U3</span></div>
        </div>
        <span class="card-cta">Ouvrir ‚Üí</span>
      </div>

      <div class="card bts" role="button" tabindex="0" onclick="openModal('bts')" onkeydown="if(event.key==='Enter'||event.key===' '){openModal('bts')}">
        <div class="card-top">
          <span class="card-emoji">üéì</span>
          <span class="card-level">BTS</span>
        </div>
        <div class="card-name">BTS MECP</div>
        <div class="card-desc">M√©tiers de l‚ÄôEsth√©tique-Cosm√©tique-Parfumerie. Units et dossiers.</div>
        <div class="units">
          <div class="unit"><span class="unit-dot"></span> UNIT 1 ‚Äî Becoming a Beauty Professional <span class="unit-num">U1</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 2 ‚Äî Skincare and Product Expertise <span class="unit-num">U2</span></div>
          <div class="unit"><span class="unit-dot"></span> UNIT 3 ‚Äî Digital Beauty <span class="unit-num">U3</span></div>
        </div>
        <span class="card-cta">Ouvrir ‚Üí</span>
      </div>

    </div>
  </section>
</main>

<footer>
  <span class="footer-brand">The English Hub</span>
  <span class="footer-meta">Lyc√©e des m√©tiers Florian</span>
</footer>

<!-- MODAL (keeps your data-driven content) -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModalOutside(event)">
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-header" id="modal-header">
      <div>
        <div class="modal-title" id="modal-title">Classe</div>
        <div class="modal-sub" id="modal-sub">Retrouve tes s√©quences</div>
      </div>
      <button class="modal-close" onclick="closeModal()" aria-label="Fermer">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="modal-sequences"></div>
    </div>
  </div>
</div>

<script>
  /* KEEP YOUR DATA (unchanged): paste your existing "const data = {...}" here */
  const data = /* ‚¨ÖÔ∏è COLLEZ ICI VOTRE OBJET data COMPLET */ {};

  function openModal(key) {
    const d = data[key];
    if (!d) return;

    document.getElementById('modal-title').textContent = d.title || 'Classe';
    document.getElementById('modal-sub').textContent = d.sub || '';
    document.getElementById('modal-header').style.borderBottomColor = 'rgba(255,255,255,0.08)';

    const container = document.getElementById('modal-sequences');
    container.innerHTML = renderMagazine(d);

    document.getElementById('modal-overlay').classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    document.getElementById('modal-overlay').classList.remove('open');
    document.body.style.overflow = '';
  }

  function closeModalOutside(e) {
    if (e.target === document.getElementById('modal-overlay')) closeModal();
  }

  document.addEventListener('keydown', function(e){
    if(e.key==='Escape') closeModal();
  });

  // Magazine render (same logic, restyled)
  function renderMagazine(d) {
    const grid = '<div class="mag-grid" id="mag-grid">' +
      (d.sequences || []).map(function(s, i){
        const wsCount = s.worksheets ? s.worksheets.length : 0;
        const imgHtml = s.img
          ? '<img loading="lazy" class="mag-img" src="' + s.img + '" alt="' + esc(s.title) + '" onerror="this.style.display=\\'none\\';this.nextSibling.style.display=\\'flex\\'">' +
            '<div class="mag-img-placeholder" style="display:none">' + (s.emoji || 'üìò') + '</div>'
          : '<div class="mag-img-placeholder">' + (s.emoji || 'üìò') + '</div>';

        return '<div class="mag-card" onclick="openMagDetail(\\'' + escJS(d.title) + '\\',' + i + ')">' +
          imgHtml +
          '<div class="mag-body">' +
            '<div class="mag-badge">' + (s.num || '') + '</div>' +
            '<div class="mag-title">' + esc(s.title || '') + '</div>' +
            '<div class="mag-desc">' + esc(shortDesc(s.desc || '')) + '</div>' +
            '<div class="mag-footer">' +
              '<span>' + (wsCount>0 ? ('üìÑ ' + wsCount + ' worksheet' + (wsCount>1?'s':'')) : '') + '</span>' +
              '<span>Voir ‚Üí</span>' +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('') +
    '</div><div class="mag-detail" id="mag-detail"></div>';

    return grid;
  }

  function openMagDetail(classTitle, idx) {
    const key = Object.keys(data).find(function(k){ return data[k].title === classTitle; });
    const d = data[key];
    const s = (d && d.sequences) ? d.sequences[idx] : null;
    if (!d || !s) return;

    const hasWs = s.worksheets && s.worksheets.length > 0;
    const imgHtml = s.img ? '<img loading="lazy" class="detail-img" src="' + s.img + '" alt="' + esc(s.title) + '" onerror="this.style.display=\\'none\\'">' : '';
    const wsHtml = hasWs ? (
      '<div class="detail-section-title">Worksheets</div>' +
      s.worksheets.map(function(w){
        return '<div class="ws-row">' +
          '<span class="ws-name">üìÑ ' + esc(w.name) + '</span>' +
          '<a class="ws-btn" href="' + w.url + '" target="_blank" rel="noopener noreferrer">Ouvrir</a>' +
          '<a class="ws-btn" href="' + w.url + '/download" target="_blank" rel="noopener noreferrer">T√©l√©charger</a>' +
        '</div>';
      }).join('')
    ) : '<div class="detail-section-title">Documents</div><div class="detail-desc">Les documents seront bient√¥t disponibles.</div>';

    const folderHtml = s.folder
      ? '<div class="detail-section-title">Dossier</div>' +
        '<a class="ws-btn" style="display:inline-flex" href="' + s.folder + '" target="_blank" rel="noopener noreferrer">Acc√©der au dossier</a>'
      : '';

    const canvaHtml = s.canva
      ? '<div class="detail-section-title">Pr√©sentation</div>' +
        '<div style="position:relative;width:100%;height:0;padding-top:56.25%;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02)">' +
          '<iframe loading="lazy" style="position:absolute;top:0;left:0;width:100%;height:100%;border:none" src="' + s.canva + '" allowfullscreen></iframe>' +
        '</div>'
      : '';

    const videoHtml = s.video
      ? '<div class="detail-section-title">Vid√©o</div>' +
        '<video controls style="width:100%;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:#000;max-height:320px">' +
          '<source src="' + s.video + '/download" type="video/mp4">' +
        '</video>'
      : '';

    document.getElementById('mag-detail').innerHTML =
      '<div class="detail-head">' +
        '<button class="back-btn" onclick="closeMagDetail()">‚Üê Retour</button>' +
        '<div class="detail-title">' + esc(s.num || '') + '</div>' +
      '</div>' +
      imgHtml +
      '<div class="detail-desc">' + esc(s.desc || '') + '</div>' +
      videoHtml +
      canvaHtml +
      folderHtml +
      wsHtml;

    document.getElementById('mag-grid').style.display = 'none';
    document.getElementById('mag-detail').classList.add('open');
  }

  function closeMagDetail(){
    const detail = document.getElementById('mag-detail');
    const grid = document.getElementById('mag-grid');
    if(detail) detail.classList.remove('open');
    if(grid) grid.style.display = '';
  }

  // Reveal cards
  window.addEventListener('load', function(){
    const cards = document.querySelectorAll('.card');
    const io = new IntersectionObserver((entries)=>{
      entries.forEach((entry, idx)=>{
        if(entry.isIntersecting){
          setTimeout(()=>entry.target.classList.add('visible'), idx*70);
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.12 });
    cards.forEach(c=>io.observe(c));
  });

  document.addEventListener('DOMContentLoaded', function(){
    twemoji.parse(document.body, { folder: 'svg', ext: '.svg' });
  });

  function shortDesc(t){
    if(!t) return '';
    const s = t.replace(/\s+/g,' ').trim();
    return s.length > 90 ? (s.substring(0,90) + '‚Ä¶') : s;
  }
  function esc(str){
    return String(str || '')
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");
  }
  function escJS(str){
    return String(str || '').replace(/\\/g,'\\\\').replace(/'/g,"\\'");
  }
</script>

</body>
</html>
